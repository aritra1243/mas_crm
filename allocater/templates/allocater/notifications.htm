{% extends 'authentication/base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-2 sidebar">
      <h5 class="text-center mb-4"><i class="fas fa-tasks"></i> Allocater</h5>
      <a href="{% url 'allocater_dashboard' %}"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
      <a href="{% url 'allocater_notifications' %}" class="active">
        <i class="fas fa-bell"></i> Notifications
        {% if unread_count > 0 %}
          <span class="badge bg-danger rounded-pill ms-2">{{ unread_count }}</span>
        {% endif %}
      </a>
      <a href="{% url 'allocater_profile' %}"><i class="fas fa-user"></i> Profile</a>
      <a href="{% url 'logout' %}"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>
    
    <!-- Main Content -->
    <div class="col-md-10 p-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>
          Notifications 
          {% if unread_count > 0 %}
            <span class="badge bg-primary">{{ unread_count }} New</span>
          {% endif %}
        </h2>
        {% if notifications %}
        <form method="POST" action="{% url 'allocater_mark_all_read' %}" style="display: inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-check-double"></i> Mark All as Read
          </button>
        </form>
        {% endif %}
      </div>

      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show mb-3" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}

      <div class="card">
        <div class="card-body">
          {% if notifications %}
            <div class="list-group">
              {% for notification in notifications %}
                <div class="list-group-item {% if not notification.is_read %}bg-light border-primary{% endif %}">
                  <div class="d-flex w-100 justify-content-between align-items-start">
                    <div class="flex-grow-1">
                      <h6 class="mb-1">
                        {% if not notification.is_read %}
                          <i class="fas fa-circle text-primary" style="font-size: 8px;"></i>
                        {% endif %}
                        {{ notification.message }}
                      </h6>
                      {% if notification.job %}
                        <small class="text-muted">
                          <i class="fas fa-briefcase"></i> Job: {{ notification.job.job_id }} - {{ notification.job.topic|truncatewords:10 }}
                        </small>
                      {% endif %}
                    </div>
                    <small class="text-muted ms-3">{{ notification.created_at|timesince }} ago</small>
                  </div>
                  {% if notification.job %}
                    <div class="mt-2">
                      <a href="{% url 'allocater_view_job' notification.job.id %}" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-eye"></i> View Job
                      </a>
                    </div>
                  {% endif %}
                </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="text-center text-muted p-5">
              <i class="fas fa-bell-slash fa-3x mb-3"></i>
              <p>No notifications yet</p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .sidebar {
    background-color: #2c3e50;
    min-height: 100vh;
    padding: 20px 0;
  }
  
  .sidebar a {
    color: #ecf0f1;
    text-decoration: none;
    padding: 15px 20px;
    display: block;
    transition: background-color 0.3s;
    position: relative;
  }
  
  .sidebar a:hover, .sidebar a.active {
    background-color: #34495e;
  }
  
  .list-group-item {
    border-left: 3px solid transparent;
    transition: all 0.3s;
  }
  
  .list-group-item:hover {
    border-left-color: #007bff;
  }
  
  .list-group-item.bg-light {
    background-color: #f8f9fa !important;
    border-left-color: #007bff !important;
  }
  
  .badge.rounded-pill {
    font-size: 0.7em;
    padding: 0.25em 0.5em;
  }
</style>
{% endblock %}